import{r as o,u as O,j as e,B as l,P,I as r,D as y,a as N,b as w,c as D,d as I,e as L}from"./index-B7iLIyza.js";function B(){const[u,S]=o.useState([]),[v,g]=o.useState([]),{toast:i}=O(),[C,x]=o.useState(!1),[b,m]=o.useState(!1),[c,j]=o.useState(""),[d,f]=o.useState(""),[s,n]=o.useState({id:"",source:"",amount:"",date:new Date().toISOString().split("T")[0],description:""});o.useEffect(()=>{h()},[]),o.useEffect(()=>{if(!u.length)return;if(!c&&!d){g(u);return}const t=u.filter(a=>{const p=new Date(a.date);return c&&d?p>=new Date(c)&&p<=new Date(d):c?p>=new Date(c):d?p<=new Date(d):!0});g(t)},[u,c,d]);const h=async()=>{try{const t=await fetch("/api/financials/revenue");if(!t.ok)throw new Error("Failed to fetch revenue");const a=await t.json();S(a)}catch{i({title:"Error",description:"Failed to fetch revenue data",variant:"destructive"})}},R=t=>{n({id:t.id.toString(),source:t.source,amount:t.amount.toString(),date:t.date,description:t.description||""}),m(!0)},k=async t=>{try{(await fetch(`/api/financials/revenue/${t}`,{method:"DELETE"})).ok&&(i({title:"Success",description:"Revenue entry deleted successfully"}),h())}catch{i({title:"Error",description:"Failed to delete revenue entry",variant:"destructive"})}},E=async()=>{try{const t=parseFloat(s.amount);if(isNaN(t)){i({title:"Error",description:"Please enter a valid amount",variant:"destructive"});return}(await fetch("/api/financials/revenue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source:s.source,amount:t,date:s.date,description:s.description})})).ok&&(i({title:"Success",description:"Revenue entry added successfully"}),x(!1),n({id:"",source:"",amount:"",date:new Date().toISOString().split("T")[0],description:""}),h())}catch{i({title:"Error",description:"Failed to add revenue entry",variant:"destructive"})}},T=async()=>{try{const t=parseFloat(s.amount);if(isNaN(t)){i({title:"Error",description:"Please enter a valid amount",variant:"destructive"});return}(await fetch(`/api/financials/revenue/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({source:s.source,amount:t,date:s.date,description:s.description})})).ok&&(i({title:"Success",description:"Revenue entry updated successfully"}),m(!1),h())}catch{i({title:"Error",description:"Failed to update revenue entry",variant:"destructive"})}},F=[{accessorKey:"source",header:"Source"},{accessorKey:"amount",header:"Amount",cell:({row:t})=>{if(!(t!=null&&t.original))return"₹0.00";const a=t.original.amount;return a!==void 0?`₹${Number(a).toFixed(2)}`:"₹0.00"}},{accessorKey:"date",header:"Date"},{accessorKey:"description",header:"Description"},{id:"actions",cell:({row:t})=>{if(!(t!=null&&t.original))return null;const a=t.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>R(a),className:"h-8 w-8 p-0",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),e.jsx("path",{d:"m15 5 4 4"})]})}),e.jsx(l,{variant:"destructive",size:"sm",onClick:()=>k(a.id),className:"h-8 w-8 p-0",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),e.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})]})})]})}}],A=v.reduce((t,a)=>t+Number(a.amount),0);return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Revenue Overview"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold",children:["₹",A.toFixed(2)]})]}),e.jsxs(l,{className:"bg-white text-black hover:bg-black hover:text-white",onClick:()=>{n({id:"",source:"",amount:"",date:new Date().toISOString().split("T")[0],description:""}),x(!0)},children:[e.jsx(P,{className:"h-4 w-4 mr-2"})," Add Revenue"]})]})]}),e.jsx("div",{className:"mb-4 bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Filter by Date Range"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Start:"}),e.jsx(r,{type:"date",value:c,onChange:t=>j(t.target.value),className:"w-auto"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"End:"}),e.jsx(r,{type:"date",value:d,onChange:t=>f(t.target.value),className:"w-auto"})]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{j(""),f("")},children:"Clear"})]})]})}),e.jsx(y,{open:C,onOpenChange:x,children:e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(D,{children:"Add Revenue"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx(r,{placeholder:"Source",value:s.source,onChange:t=>n({...s,source:t.target.value})}),e.jsx(r,{type:"number",placeholder:"Amount",value:s.amount,onChange:t=>n({...s,amount:t.target.value})}),e.jsx(r,{type:"date",value:s.date,onChange:t=>n({...s,date:t.target.value})}),e.jsx(r,{placeholder:"Description",value:s.description,onChange:t=>n({...s,description:t.target.value})}),e.jsx(l,{onClick:E,children:"Add Revenue"})]})]})}),e.jsx(y,{open:b,onOpenChange:m,children:e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(D,{children:"Edit Revenue"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx(r,{placeholder:"Source",value:s.source,onChange:t=>n({...s,source:t.target.value})}),e.jsx(r,{type:"number",placeholder:"Amount",value:s.amount,onChange:t=>n({...s,amount:t.target.value})}),e.jsx(r,{type:"date",value:s.date,onChange:t=>n({...s,date:t.target.value})}),e.jsx(r,{placeholder:"Description",value:s.description,onChange:t=>n({...s,description:t.target.value})}),e.jsx(l,{onClick:T,children:"Update Revenue"})]})]})}),u.length===0?e.jsx("div",{className:"text-center p-8 border rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"No revenue entries found. Add your first revenue entry!"})}):v.length===0?e.jsx("div",{className:"text-center p-8 border rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"No revenue entries found in the selected date range."})}):e.jsx(I,{columns:F,data:v})]})}function M(){return e.jsx(L,{title:"Revenue",description:"Track and manage your revenue streams",children:e.jsx(B,{})})}export{M as default};
